# ===============================================
# APS-Loom Configuration Sample
# ===============================================
# Copy this file to .env and modify values as needed
# All commented-out settings show their default values


# === Basic Settings ===

# Project identifier (required)
PROJECT_NAME=aps-loom

# API server port
# Default: (must be specified)
PORT=7100

# Server bind address
# Default: 0.0.0.0
SERVER_NAME=0.0.0.0

# Base directory for file operations
# Default: current working directory
#BASE_DIR=/path/to/project

# Application version
# Default: 0.0.1.2
#VERSION=0.0.1.2

# Enable debug mode with additional logging
# Default: false
#DEBUG=false

# Enable detailed schedule debugging logs (lday, batches, etc.)
# Default: false
#DEBUG_SCHEDULE=false


# === Solver Settings ===

# Maximum solver time in seconds
# Default: 200
LOOM_MAX_TIME=300

# Number of parallel solver workers
# Default: 1
#LOOM_NUM_WORKERS=1

# Enable solution enumeration (find multiple solutions)
# Default: false
#SOLVER_ENUMERATE=false

# Number of solutions to enumerate (when SOLVER_ENUMERATE=true)
# Default: 3
#SOLVER_ENUMERATE_COUNT=3

# Use greedy heuristic to seed initial solution hints
# Default: false
#USE_GREEDY_HINT=false


# === Test Data Settings ===

# Enable test data calculation mode
# Default: false
CALC_TEST_DATA=true

# Path to test input JSON file (required when CALC_TEST_DATA=true)
TEST_INPUT_FILE=example/test_in.json


# === Horizon Mode ===

# Scheduling horizon mode:
#   FULL           - Full detailed model with all constraints
#   LONG_SIMPLE    - Simplified long-horizon model (3 shifts = 1 day)
#   LONG_TWO_PHASE - Two-phase approach (Phase 1: allocation, Phase 2: scheduling)
# Default: FULL
HORIZON_MODE=LONG_TWO_PHASE


# === Constraint Flags ===

# Apply qty_minus constraints (flexible volume deviation)
# Default: true
APPLY_QTY_MINUS=true

# Apply index_up constraints (quantity index only increases)
# Default: true
#APPLY_INDEX_UP=false

# Apply division/sector constraints in models
# If false, division boundaries are ignored in CP model
# Default: true
#APPLY_DIV_CONSTRAINTS=true

# Apply downtime limits (PRODUCT_ZERO constraints)
# Master flag for all downtime-related constraints
# Default: true
APPLY_DOWNTIME_LIMITS=true

# Apply limit on PRODUCT_ZERO count per day across all machines
# (only effective if APPLY_DOWNTIME_LIMITS=true)
# Default: true
#APPLY_ZERO_PER_DAY_LIMIT=true

# Apply limit on total PRODUCT_ZERO per machine over horizon
# (only effective if APPLY_DOWNTIME_LIMITS=true)
# Default: true
#APPLY_ZERO_PER_MACHINE_LIMIT=true

# Ban third consecutive PRODUCT_ZERO after two-day transition
# (only effective if APPLY_DOWNTIME_LIMITS=true)
# Default: true
#APPLY_THIRD_ZERO_BAN=true

# Apply transition business logic (two-day transitions, third-zero ban, etc.)
# Master flag for transition-related constraints
# Default: true
#APPLY_TRANSITION_BUSINESS_LOGIC=true


# === Objective Function Settings ===

# Include proportion penalty in objective (deviation from planned quantities)
# Default: true
#APPLY_PROP_OBJECTIVE=true

# Include strategy penalty in objective (product strategy adherence)
# Default: true
#APPLY_STRATEGY_PENALTY=true

# Downtime penalty coefficient (multiplier for PRODUCT_ZERO cost)
# Default: 10
#KFZ_DOWNTIME_PENALTY=10

# Use linear overage penalty instead of proportional penalty
# (only for LONG_SIMPLE mode, when APPLY_PROP_OBJECTIVE=true)
# Default: false
#APPLY_OVERPENALTY_INSTEAD_OF_PROP=false


# === LONG_SIMPLE Mode Settings ===

# Use full proportional algorithm with multiplication in LONG_SIMPLE
# (instead of simplified linear penalty)
# Default: false
#SIMPLE_USE_PROP_MULT=false

# Enable monotonicity constraints on product counts by day
# Default: true
SIMPLE_USE_MONOTONE_COUNTS=true

# Disable INDEX_UP constraint in LONG_SIMPLE mode only
# (overrides APPLY_INDEX_UP for LONG_SIMPLE)
# Default: false
#SIMPLE_DISABLE_INDEX_UP=false

# Maximum number of balance products (qty_minus!=0) per division
# Balance products have more flexible volume deviation
# Default: 1
#SIMPLE_QTY_MINUS_MAX_BALANCE_PER_DIV=1

# Threshold: if division already has this many flexible products,
# skip selecting additional balance products
# Default: 2
SIMPLE_QTY_MINUS_BALANCE_THRESHOLD=2

# Enable big-no-start heuristic in LONG_SIMPLE
# (large products without initial machines can fully occupy one machine)
# Set to any non-empty string to enable, empty/null to disable
# Default: null (disabled)
#SIMPLE_ENABLE_BIG_NOSTART_HEURISTIC=


# === Debug Settings for LONG_SIMPLE ===

# Enable debug mode for heuristics H1-H3 in LONG_SIMPLE
# Default: false
#SIMPLE_DEBUG_H_START=false

# Heuristic combination in debug mode: NONE, H1, H2, H3, H12, H123
# (only effective when SIMPLE_DEBUG_H_START=true)
#
# Эвристики для начального состояния продуктов:
#   H1 - Фиксация продуктов на стартовых машинах:
#        Если продукт уже стоит на машинах в начале периода, он закрепляется
#        за этими машинами на весь горизонт планирования
#
#   H2 - Запрет продуктов без стартовых машин:
#        Продукты, которые не стоят ни на одной машине в начале периода,
#        полностью запрещаются на весь горизонт (не включаются в план)
#
#   H3 - Эвристика больших продуктов без старта:
#        Большие продукты (объём > порога) без стартовых машин могут полностью
#        занять одну подходящую машину на весь горизонт и запрещаются на остальных
#
#   H4 - Фиксация продуктов на нескольких стартовых машинах:
#        Если продукт стоит на нескольких машинах и его объёма достаточно только
#        для этих машин, он фиксируется на них и запрещается на других машинах
#
#   H5 - Усиление стратегии (Strategy Hardening):
#        Преобразование стратегий продуктов (--, -, =, +, ++) в жёсткие ограничения
#        монотонности количества машин по дням с проверками безопасности
#
# Default: null
#SIMPLE_DEBUG_H_MODE=H123

# Subset of product indices for applying qty_minus constraints
# (debug/testing only, JSON array format: [2, 3, 4, 5])
# Default: null (apply to all)
#SIMPLE_QTY_MINUS_SUBSET=[2, 3, 4, 5]

# Enable super-simple debug model (minimal constraints, no transitions/monotonicity)
# Default: false
#SIMPLE_DEBUG_SUPER_SIMPLE=false

# Product index to minimize in objective (for feasibility debugging)
# Default: null
#SIMPLE_DEBUG_MINIMIZE_PRODUCT_IDX=

# Product index to maximize in objective (for capacity testing)
# Default: null
#SIMPLE_DEBUG_MAXIMIZE_PRODUCT_IDX=

# Upper bounds for specific products: {"product_idx": cap_days}
# (JSON object format: {"10": 25, "15": 30})
# Default: null
#SIMPLE_DEBUG_PRODUCT_UPPER_CAPS=

# External product index for constraint dump
# Default: null
#SIMPLE_DEBUG_DUMP_CONSTRAINTS_FOR_IDX=


# === Two-Phase Integration ===

# Path to save result JSON (for Phase 1 output or Phase 2 integration)
# If null, results are not saved to file
# Default: null
#SAVE_RESULT_JSON_PATH=log/result.json


# ===============================================
# End of Configuration
# ===============================================
